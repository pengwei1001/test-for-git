# **播放規則**
| 顯示頁面 | 即時動態、遊戲大廳、遊戲內顯示 |
|--|--|
| 跑馬燈單筆顯示時間 | 6 秒，資訊過多拆成2行，3 秒播一行。 |
| 跑馬燈類型 | 依播放順序為系統公告 → 摸彩趣中獎資訊 → JP → 一般遊戲資訊 4 次 → 一般公告 1 次 |
| 跑馬燈循環流程 | 
|1.|判斷系統公告：
|1-1.|同個時段只會有一筆系統公告存在
|1-2.|如果有無限循環的公告就持續播放該系統公告。|
|1-3.|依循環時間循環播放系統公告
|2.|新收到且優先權較高的先播放
|3.|依優先權較高的跑馬燈播放：
|3-1.|目前跑馬燈的類型回合跑完，會將下個回合的跑馬燈restart。
|3-2.|所有跑馬燈跑完只會播放公告類型的跑馬燈(公告無播放次數)
|3-3.|有新得跑馬燈會在輪播。
|4.|跑馬燈最多 50 筆循環


# **WEB API 規則**

| |**webApi_GetMarquee** |  | 
|--|--|--|
| 一般跑馬燈類型 | JpMarquee = 1, BigWinMarquee = 2, OtherActivityMarquee = 5 |JP、BigWin、外贈
| 跑馬燈流水編號 | 用時戳來決定播放的次序 | 
| 跑馬燈字串 | 使用跑馬燈格式來組裝一般跑馬燈訊息 |
| 贏得點數 | ≧ 100000 時閃爍 |
| 可播放次數 | 預設 10 次 |
|| **webApi_GetMarqueeFormat** | 使用跑馬燈格式來組裝一般跑馬燈訊息
| |**WebApi_GetBulletin** |  |
| 一般公告 | enNormalBulletin = 3 |不會閃爍，無播放次數限制。預設為：「歡迎光臨，老子有錢」，後台有設定則以後台為準，可有一筆以上，整個request result 更新|
|系統公告|enSystemBulletin = 4|系統公告循環，最多只能一筆。sleepSeconds = 0,無限循環 sleepSeconds > 0, 依 sleepTime 決定循環時間|
|樂透跑馬燈||只播一次|
||CompositeMarqueeSubject|6 秒呼叫一次 MarqueeManager getCurrMarquee，發通知。|
||CompositeMarqueeObserver|O8App_MarqueeView、遊戲中都會呼叫此觀察者處理跑馬燈資訊。|
||MarqueePlayInfomation|每一則的跑馬燈資訊（跑馬燈內容、是否閃爍、跑馬燈類型）|
||O8App_MarqueeView|開啟時候會呼叫一次 MarqueeManager getCurrMarquee。系統使用的跑馬燈畫面，如果字數超過，該次跑馬燈播放時間/2，播放內容依序顯示。|
||NormalMarquee|JP、BigWin、外贈、樂透跑馬燈|
||NormalBulletin|一般公告|
||SystemBulletin:NormalBulletin|系統公告|
||MarqueeQueue|跑馬燈先播未播過的, 再播可重播的.        
||-unused|未播放的會先丟到 unused|
||-played|播放過的，可播放次數大於 0 的會丟到此堆疊|
||-replay|可重播的，沒了會將播放過的全丟進來|
||-clearOld|最多50筆循環|
|一般跑馬燈用|jp,lottery,normalMarquee||
||SidIncreaseMarqueeQueue : MarqueeQueue|sid 順序如果不對, 或者是會執行中歸零, 會發生錯誤|
|一般公告用|||
||IntactUpdateMarqueeQueue : MarqueeQueue|每次取得的新資料, 都是完整的(沒在列表中的就是被停用了), 但是要保留現有的已播過資訊, 且 sid 大小無規律|
|系統公告用|||
||UniqueMarqueeQueue : IntactUpdateMarqueeQueue|最多只會有一個在裡面, 且無法以 sid 判斷先後|
||||
||MarqueeManager|跑馬燈管理器|
||start||
|取得跑馬燈格式|開始取得跑馬燈內容(30s)|新增跑馬燈加入type = jp, sid>maxid addObject，放入jp queue。other, sid>maxid addObject，放入normal queue。getMarquee,新資料會串好格式 add to list 。|
|取得公告(30s)|開始取得公告跑馬燈內容(30s)|分別放入系統或一般公告的queue|
||getCurrMarquee||
|取得目前跑馬燈|播放順序：系統 → 樂透 → JP → 一般遊戲資訊 → 一般公告|
||1.先判斷系統公告||
||2.新收到且優先權較高的先播放||
||3.依序取得播放的跑馬燈，||
||3.1.目前跑馬燈的類型回合跑完，會將下個回合的跑馬燈restart。||
||3.2.所有跑馬燈跑完只會播放公告類型的跑馬燈(公告無播放次數)||
||有新的跑馬燈會再輪播||
||getSustainedSystemBulletin|取得持續的系統公告。如果是無限循環的公告就返回值。不然就依循環時間|
||getNewMarquee|取得新的ㄧ筆跑馬燈資料|